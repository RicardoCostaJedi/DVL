<!DOCTYPE html>
<html>
  <head>
    <title>DVL Histogram Text</title>
    <link type="text/css"         href="../../css/smoothness/jquery-ui-1.8.7.custom.css" rel="Stylesheet" />	
    <script type="text/javascript" src="../../js/jquery-1.4.4.min.js"></script>
    <script type="text/javascript" src="../../js/jquery-ui-1.8.7.custom.js"></script>
    <script type="text/javascript" src="../../d3.js"></script>
    <script type="text/javascript" src="../../protovis-r3.2.js"></script>
    <script type="text/javascript" src="../../sprintf.js"></script>
    <script type="text/javascript" src="../../dvl.js"></script>
    <script type="text/javascript" src="text.js"></script>
    <style type="text/css">

body {
  font: 12px sans-serif;
}

.background {
  fill: #ccc;
}

.lines {
  shape-rendering: crispEdges;
}

.bars {
  fill: steelblue;
}

    </style>

  </head>
  <body>
  </body>
  <script type="text/javascript">
  
  text = text.toUpperCase().replace(/[^A-Z]/g, '');
  
  var letters = dvl.const("ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(''));

  data = dvl.def([], 'data');

	var getY = dvl.acc('letter');
	var getX = dvl.acc('count');
	var duration = 0;
	
	var size = dvl.def({ width: 800, height: 700 }, "size");
	var margin = dvl.def({ top: 30, bottom: 30, left: 30, right: 10 }, "margin");
  
  var panel = dvl.svg.canvas({
    selector:'body',
    size:size,
    margin:margin
  });
	
  var sx = dvl.scale.linear({
    name: "scale_x",
    domain: { data:data, acc:getX },
    rangeFrom: 0,
    rangeTo: panel.width,
    padding: 10,
    anchor: true
  })
  
  var sy = dvl.scale.ordinal({
    name: "scale_y",
    domain: { data:letters },
    rangeFrom: 0,
    rangeTo: panel.height,
    padding: 10
  });
  
  var scaledTicksX = dvl.gen.fromArray(sx.ticks, null, sx.scale),
      scaledTicksY = dvl.gen.fromArray(sy.ticks, null, sy.scale);
      
  var formatedTicksX = dvl.gen.fromArray(sx.ticks, null, function(d) { return d.toFixed(0); });
  
  var sizeY = dvl.apply({
    fn: function(b) { return 0.9 * b; },
    args: sy.band
  });

  dvl.svg.bars({
    panel: panel,
    duration: duration,
    props: {
      key: dvl.gen.fromArray(data, function(d) { return d.pair; }),
      left: 10,
      centerY: dvl.gen.fromArray(data, getY, sy.scale),
      width: dvl.gen.sub(dvl.gen.fromArray(data, getX, sx.scale), dvl.const(10)),
      height: sizeY
    }
  });
  
  dvl.svg.lines({
    panel: panel,
    duration: duration,
    props: {
      key: sx.ticks,
      left: scaledTicksX,
      top1: 0,
      bottom2: 0,
      stroke: "white"
    }
  });
  
  dvl.svg.lines({
    panel: panel,
    duration: duration,
    props: {
      left: 10,
      top1: 0,
      bottom2: 0,
      stroke: "black"
    }
  });
  
  dvl.svg.labels({
    panel: panel,
    duration: duration,
    props: {
      key: sx.ticks,
      left: scaledTicksX,
      bottom: -3,
      text: formatedTicksX,
      baseline: "top",
      align: "middle"
    }
  });
  
  dvl.svg.labels({
    panel: panel,
    duration: duration,
    props: {
      key: sx.ticks,
      left: scaledTicksX,
      top: -3,
      text: formatedTicksX,
      baseline: "bottom",
      align: "middle"
    }
  });
  
  dvl.svg.labels({
    panel: panel,
    duration: duration,
    props: {
      key: sy.ticks,
      left: -3,
      top:  scaledTicksY,
      text: sy.ticks,
      align: "end",
      baseline: "middle"
    }
  });
  
  ////////////////////////////
  var pos = 0;
  var timer = setInterval(function() {
    if(pos >= text.length) {
      clearInterval(timer);
    } else {
      letter = text[pos];
      //console.log(pos, pair);
      ds = data.get();
      var found = false;
      for (var i=0; i < ds.length; i++) {
        if(ds[i].letter == letter) {
          ds[i].count += 1;
          found = true;
          break;
        }
      }
      if (!found) {
        data.push({
          letter: letter,
          count: 1
        });
      }
      data.notify();
      pos += 1;
    }
  }, 20);

  </script>
</html>
